{"version":3,"sources":["../src/dynatraceufo_ctrl.js"],"names":["MetricsPanelCtrl","_","TimeSeries","panelDefaults","bgColor","dynatraceUfoSettings","fontColor","gridColor","fontSize","legendType","ignoreTimeInfluxDB","limitAspectRatio","aspectRatio","seriesAlias","DynatraceUfoCtrl","$scope","$injector","$rootScope","defaultsDeep","panel","events","on","onInitEditMode","bind","onPanelTeardown","render","onRender","onDataReceived","onDataError","data","ctx","ufo","canvasid","updateStatus","whirlCw","whirlCcw","startWhirl","currentOptions","noOfLeds","topColors","bottomColors","logoColors","updateUfo","addEditorTab","$timeout","cancel","nextTickPromise","series","clockwise","config","datasets","backgroundColor","unshift","pop","push","shift","console","log","createLEDring","length","fillBottomColors","label","fillTopColors","labels","createLabels","options","responsive","legend","multiTooltipTemplate","animation","animateRotate","animateScale","type","JSON","stringify","document","getElementById","getContext","Chart","dataList","jsonData","json","parse","device","leds","logo","top","color","bottom","arr","Array","i","colorArray","templateUrl"],"mappings":"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","file":"dynatraceufo_ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport './css/dynatraceufo-panel.css!';\r\nimport './Chart.js'\r\n\r\nconst panelDefaults = {\r\n  bgColor: null,\r\n\r\n  dynatraceUfoSettings: {\r\n    fontColor: 'gray',\r\n    gridColor: 'gray',\r\n    fontSize: 14,\r\n    legendType: 'right',\r\n    ignoreTimeInfluxDB: false,\r\n    limitAspectRatio: true,\r\n    aspectRatio: 2.2,\r\n    seriesAlias: ''\r\n  }\r\n};\r\n\r\nexport class DynatraceUfoCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector, $rootScope) {\r\n    super($scope, $injector);\r\n    _.defaultsDeep(this.panel, panelDefaults);\r\n\r\n    this.$rootScope = $rootScope;\r\n\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n    this.events.on('panel-initialized', this.render.bind(this));\r\n\r\n    this.events.on('render', this.onRender.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n\r\n    this.data = [];\r\n    this.ctx = null;\r\n    this.ufo = null;\r\n\r\n    this.canvasid = \"1\";\r\n    this.updateStatus = \"2\";\r\n    this.whirlCw = \"3\";\r\n    this.whirlCcw = \"4\";\r\n    this.startWhirl = \"5\";\r\n\r\n    this.currentOptions = null;\r\n\r\n    this.noOfLeds = 15;\r\n    this.topColors = [];\r\n    this.bottomColors = [];\r\n    this.logoColors = [];\r\n\r\n    this.updateUfo();\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/plugins/djimmo-dynatrace-ufo/editor.html', 2);\r\n  }\r\n\r\n  onPanelTeardown() {\r\n    this.$timeout.cancel(this.nextTickPromise);\r\n  }\r\n\r\n  onDataError() {\r\n    this.series = [];\r\n    this.render();\r\n  }\r\n\r\n  whirl(clockwise) {\r\n    if (clockwise) {\r\n      config.data.datasets[0].backgroundColor.unshift(config.data.datasets[0].backgroundColor.pop());\r\n    } else {\r\n      config.data.datasets[0].backgroundColor.push(config.data.datasets[0].backgroundColor.shift());\r\n    }\r\n    console.log('test: trying to whirl!');\r\n    this.render();\r\n  }\r\n\r\n  onRender() {\r\n    this.data = {\r\n      datasets: [{\r\n        data: this.createLEDring(this.bottomColors.length),\r\n        backgroundColor: this.fillBottomColors(this.bottomColors),\r\n        label: 'Bottom Ring'\r\n      }, {\r\n        data: this.createLEDring(this.topColors.length),\r\n        backgroundColor: this.fillTopColors(this.topColors),\r\n        label: 'Top Ring'\r\n      }],\r\n      labels: this.createLabels()\r\n    };\r\n\r\n    this.options = {\r\n      responsive: true,\r\n      legend: false,\r\n      multiTooltipTemplate: '<%= datasetLabel %> - <%= value %>',\r\n      animation: {\r\n        animateRotate: false,\r\n        animateScale: true\r\n      }\r\n    };\r\n\r\n    var config = {\r\n      type: 'doughnut',\r\n      data: this.data,\r\n      options: this.options\r\n    };\r\n\r\n    if (this.currentOptions == null)\r\n      this.currentOptions = JSON.stringify(this.options);\r\n\r\n    if (this.ctx == null)\r\n      if (document.getElementById(this.canvasid) != null)\r\n        this.ctx = document.getElementById(this.canvasid).getContext('2d');\r\n\r\n    if (this.ctx != null) {\r\n      this.ufo = new Chart(this.ctx, config);\r\n    }\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    console.log('Data Received!');\r\n    console.log(dataList);\r\n\r\n    var jsonData = '{\"timestamp\":\"1827609\",\"device\":{\"id\":\"ufo-30aea420be35\",\"clientIP\":\"172.28.165.246\",\"ssid\":\"Royal-Guest\",\"version\":\"Dec 17 2018 - 12:02:57\",\"build\":\"1000\",\"cpu\":\"ESP32\",\"battery\":\"100\",\"temperature\":\"22.12\",\"leds\": {\"logo\": [\"ff0000\", \"00ff40\", \"00ff00\", \"000044\"], \"top\": {\"color\": [\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ffff00\",\"ff0000\"],\"background\": \"000000\",\"whirl\": {\"speed\": 0,\"clockwise\": 0},\"morph\": { \"state\": 1, \"period\": 80, \"periodTick\": 80, \"speed\": 8, \"speedTick\": 1, \"percentage\": 68}},\"bottom\": {\"color\": [\"004400\",\"ff4400\",\"ff4400\",\"ff4400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\"],\"background\": \"000000\",\"whirl\": {\"speed\": 0,\"clockwise\": 0},\"morph\": { \"state\": 1, \"period\": 80, \"periodTick\": 80, \"speed\": 8, \"speedTick\": 3, \"percentage\": 70}}},\"freemem\":\"143588\"}}';\r\n    var json = JSON.parse(jsonData);\r\n\r\n    this.logoColors = json.device.leds.logo;\r\n    this.topColors = json.device.leds.top.color;\r\n    this.bottomColors = json.device.leds.bottom.color;\r\n\r\n    this.render();\r\n  }\r\n\r\n  updateUfo() {\r\n    this.nextTickPromise = this.$timeout(this.updateUfo.bind(this), 1000);\r\n  }\r\n\r\n  createLEDring(noOfLeds) {\r\n    var arr = new Array(noOfLeds);\r\n    for (var i = 0; i < noOfLeds; i++) {\r\n      arr[i] = 1;\r\n    }\r\n    return arr;\r\n  };\r\n\r\n  createLabels() {\r\n    var arr = new Array(this.noOfLeds);\r\n    for (var i = 0; i < this.noOfLeds; i++) {\r\n      arr[i] = 'LED #' + (i + 1);\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  fillTopColors(topColors) {\r\n    var colorArray = new Array(this.noOfLeds);\r\n    for (var i = 0; i < this.noOfLeds; i++) {\r\n      colorArray[i] = '#' + topColors[i];\r\n    }\r\n    return colorArray;\r\n  }\r\n\r\n  fillBottomColors(bottomColors) {\r\n    var colorArray = new Array(this.noOfLeds);\r\n    for (var i = 0; i < this.noOfLeds; i++) {\r\n      colorArray[i] = '#' + bottomColors[i];\r\n    }\r\n    return colorArray;\r\n  }\r\n}\r\n\r\nDynatraceUfoCtrl.templateUrl = 'module.html';"]}