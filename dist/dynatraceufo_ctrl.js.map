{"version":3,"sources":["../src/dynatraceufo_ctrl.js"],"names":["MetricsPanelCtrl","_","TimeSeries","panelDefaults","bgColor","dynatraceUfoSettings","fontColor","gridColor","fontSize","DynatraceUfoCtrl","$scope","$injector","$rootScope","defaultsDeep","panel","events","on","onInitEditMode","bind","onPanelTeardown","render","onRender","onDataReceived","onDataError","data","ctx","ufo","canvasid","currentOptions","ufoId","ufoClientIP","ufoWifiSsid","topColors","bottomColors","logoColors","availUfos","selectedUfo","updateUfo","addEditorTab","$timeout","cancel","nextTickPromise","series","clockwise","config","datasets","backgroundColor","unshift","pop","push","shift","console","log","createLEDring","length","label","labels","createLabels","options","responsive","aspectRatio","legend","multiTooltipTemplate","animation","animateRotate","animateScale","type","JSON","stringify","document","getElementById","getContext","Chart","dataList","jsonData","json","parse","device","id","clientIP","ssid","leds","logo","map","val","top","color","bottom","noOfLeds","arr","Array","i","templateUrl"],"mappings":"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","file":"dynatraceufo_ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport './css/dynatraceufo-panel.css!';\r\nimport './Chart.js'\r\n\r\nconst panelDefaults = {\r\n  bgColor: null,\r\n\r\n  dynatraceUfoSettings: {\r\n    fontColor: 'gray',\r\n    gridColor: 'gray',\r\n    fontSize: 14\r\n  }\r\n};\r\n\r\nexport class DynatraceUfoCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector, $rootScope) {\r\n    super($scope, $injector);\r\n    _.defaultsDeep(this.panel, panelDefaults);\r\n\r\n    this.$rootScope = $rootScope;\r\n\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n    this.events.on('panel-initialized', this.render.bind(this));\r\n\r\n    this.events.on('render', this.onRender.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n\r\n    this.data = [];\r\n    this.ctx = null;\r\n    this.ufo = null;\r\n\r\n    this.canvasid = \"canvas\";\r\n\r\n    this.currentOptions = null;\r\n\r\n    this.ufoId = null;\r\n    this.ufoClientIP = null;\r\n    this.ufoWifiSsid = null;\r\n    this.topColors = [];\r\n    this.bottomColors = [];\r\n    this.logoColors = [];\r\n\r\n    this.availUfos = [];\r\n    this.selectedUfo = null;\r\n\r\n\r\n    this.updateUfo();\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/plugins/djimmo-dynatrace-ufo/editor.html', 2);\r\n  }\r\n\r\n  onPanelTeardown() {\r\n    this.$timeout.cancel(this.nextTickPromise);\r\n  }\r\n\r\n  onDataError() {\r\n    this.series = [];\r\n    this.render();\r\n  }\r\n\r\n  whirl(clockwise) {\r\n    if (clockwise) {\r\n      config.data.datasets[0].backgroundColor.unshift(config.data.datasets[0].backgroundColor.pop());\r\n    } else {\r\n      config.data.datasets[0].backgroundColor.push(config.data.datasets[0].backgroundColor.shift());\r\n    }\r\n    console.log('test: trying to whirl!');\r\n    this.render();\r\n  }\r\n\r\n  onRender() {\r\n    this.data = {\r\n      datasets: [{\r\n        data: this.createLEDring(this.bottomColors.length),\r\n        backgroundColor: this.bottomColors,\r\n        label: 'Bottom Ring'\r\n      }, {\r\n        data: this.createLEDring(this.topColors.length),\r\n        backgroundColor: this.topColors,\r\n        label: 'Top Ring'\r\n      }],\r\n      labels: this.createLabels(this.topColors.length)\r\n    };\r\n\r\n    this.options = {\r\n      responsive: true,\r\n      aspectRatio: 1.4,      \r\n      legend: false,\r\n      multiTooltipTemplate: '<%= datasetLabel %> - <%= value %>',\r\n      // title: {\r\n      //   display: true,\r\n      //   text: 'Dynatrace Ufo ' + this.ufoId\r\n      // },\r\n      animation: {\r\n        animateRotate: false,\r\n        animateScale: true\r\n      }\r\n    };\r\n\r\n    var config = {\r\n      type: 'doughnut',\r\n      data: this.data,\r\n      options: this.options\r\n    };\r\n\r\n    if (this.currentOptions == null)\r\n      this.currentOptions = JSON.stringify(this.options);\r\n\r\n    if (this.ctx == null)\r\n      if (document.getElementById(this.canvasid) != null)\r\n        this.ctx = document.getElementById(this.canvasid).getContext('2d');\r\n\r\n    if (this.ctx != null) {\r\n      this.ufo = new Chart(this.ctx, config);\r\n    }\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    console.log('Data Received!');\r\n    console.log(dataList);\r\n\r\n    var jsonData = '{\"timestamp\":\"1827609\",\"device\":{\"id\":\"ufo-30aea420be35\",\"clientIP\":\"172.28.165.246\",\"ssid\":\"Royal-Guest\",\"version\":\"Dec 17 2018 - 12:02:57\",\"build\":\"1000\",\"cpu\":\"ESP32\",\"battery\":\"100\",\"temperature\":\"22.12\",\"leds\": {\"logo\": [\"ff0000\", \"00ff40\", \"00ff00\", \"000044\"], \"top\": {\"color\": [\"ff0000\",\"00f400\", \"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ff0000\",\"ffff00\",\"ff0000\"],\"background\": \"000000\",\"whirl\": {\"speed\": 0,\"clockwise\": 0},\"morph\": { \"state\": 1, \"period\": 80, \"periodTick\": 80, \"speed\": 8, \"speedTick\": 1, \"percentage\": 68}},\"bottom\": {\"color\": [\"004400\",\"ff4400\",\"ff4400\",\"ff4400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\",\"004400\"],\"background\": \"000000\",\"whirl\": {\"speed\": 0,\"clockwise\": 0},\"morph\": { \"state\": 1, \"period\": 80, \"periodTick\": 80, \"speed\": 8, \"speedTick\": 3, \"percentage\": 70}}},\"freemem\":\"143588\"}}';\r\n    var json = JSON.parse(jsonData);\r\n\r\n    this.ufoId = json.device.id;\r\n    this.availUfos.push(this.ufoId);\r\n    this.selectedUfo = this.availUfos[0];\r\n    this.ufoClientIP = json.device.clientIP;\r\n    this.ufoWifiSsid = json.device.ssid;\r\n    this.logoColors = json.device.leds.logo.map(val => '#' + val);\r\n    this.topColors = json.device.leds.top.color.map(val => '#' + val);\r\n    this.bottomColors = json.device.leds.bottom.color.map(val => '#' + val);\r\n\r\n\r\n    console.log('Visualizing UFO on IP: ' + json.device.clientIP + '. Connected to WiFi: ' + json.device.ssid);\r\n    console.log('UFO has ' + this.topColors.length + ' top LEDS and ' + this.bottomColors.length + ' bottom LEDS.');\r\n\r\n    this.render();\r\n  }\r\n\r\n  updateUfo() {\r\n    this.nextTickPromise = this.$timeout(this.updateUfo.bind(this), 1000);\r\n  }\r\n\r\n  createLEDring(noOfLeds) {\r\n    var arr = new Array(noOfLeds);\r\n    for (var i = 0; i < noOfLeds; i++) {\r\n      arr[i] = 1;\r\n    }\r\n    return arr;\r\n  };\r\n\r\n  createLabels(noOfLeds) {\r\n    var arr = new Array(noOfLeds);\r\n    for (var i = 0; i < noOfLeds; i++) {\r\n      arr[i] = 'LED #' + (i + 1);\r\n    }\r\n    return arr;\r\n  }\r\n}\r\n\r\nDynatraceUfoCtrl.templateUrl = 'module.html';"]}