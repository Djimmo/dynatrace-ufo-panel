{"version":3,"sources":["../src/dynatraceufo_ctrl.js"],"names":["MetricsPanelCtrl","_","panelDefaults","showUfoName","showUfoIP","showUfoWiFi","showUfoLastUpdate","showDropdown","jsonFields","ufoName","ufoDeviceId","ufoClientIP","ufoSSID","ufoLeds","ufoLedsLogo","ufoLedsTop","ufoLedsBottom","ufoLedsColor","ufoLedsWhirlSpeed","ufoLedsWhirlDir","ufoLedsMorphState","lastUpdate","DynatraceUfoCtrl","$scope","$injector","$interval","defaultsDeep","panel","events","on","onInitEditMode","bind","onPanelTeardown","render","onRender","onDataReceived","onDataError","data","ctx","ufo","canvasid","Math","random","replace","topColors","bottomColors","logoColors","opacity","morphFadeOut","traverseJson","model","path","def","parts","split","length","splice","join","updateLedData","selectedUfoJson","json","filter","val","selectedUfo","sort","a","b","Date","ufoWifiSsid","ufoLastUpdate","map","toString","cancel","whirlIntervalTop","unshift","pop","push","shift","whirlIntervalBottom","morphIntervalTop","substring","morphIntervalBottom","console","log","addEditorTab","datasets","createLEDring","backgroundColor","label","labels","createLabels","options","responsive","aspectRatio","legend","multiTooltipTemplate","animation","config","type","document","getElementById","getContext","Chart","update","dataList","datapoints","availUfos","Set","undefined","noOfLeds","arr","Array","i","templateUrl"],"mappings":"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","file":"dynatraceufo_ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport './css/dynatraceufo-panel.css!';\r\nimport './Chart.js';\r\nimport _ from 'lodash';\r\n\r\nconst panelDefaults = {\r\n  showUfoName: true,\r\n  showUfoIP: true,\r\n  showUfoWiFi: true,\r\n  showUfoLastUpdate: true,\r\n  showDropdown: true,\r\n\r\n  jsonFields: {\r\n    ufoName: 'detailInfo.ufo',\r\n    ufoDeviceId: 'detailInfo.deviceId',\r\n    ufoClientIP: 'detailInfo.clientIP',\r\n    ufoSSID: 'detailInfo.ssid',\r\n    ufoLeds: 'detailInfo.leds',\r\n    ufoLedsLogo: 'logo',\r\n    ufoLedsTop: 'top',\r\n    ufoLedsBottom: 'bottom',\r\n    ufoLedsColor: 'color',\r\n    ufoLedsWhirlSpeed: 'whirl.speed',\r\n    ufoLedsWhirlDir: 'whirl.clockwise',\r\n    ufoLedsMorphState: 'morph.state',\r\n    lastUpdate: 'ActivityTime'\r\n  }\r\n};\r\n\r\nexport class DynatraceUfoCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector, $interval) {\r\n    super($scope, $injector);\r\n    _.defaultsDeep(this.panel, panelDefaults);\r\n\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n    this.events.on('panel-initialized', this.render.bind(this));\r\n\r\n    this.events.on('render', this.onRender.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n\r\n    this.data = [];\r\n    this.ctx = null;\r\n    this.ufo = null;\r\n\r\n    this.canvasid = (\"id\" + (Math.random() * 100000)).replace('.', '');\r\n\r\n    this.topColors = [];\r\n    this.bottomColors = [];\r\n    this.logoColors = [];\r\n\r\n    this.opacity = 0xff;\r\n    this.morphFadeOut = true;\r\n\r\n    this.traverseJson = function (model, path, def) {\r\n      path = path || '';\r\n      model = model || {};\r\n      def = typeof def === 'undefined' ? '' : def;\r\n      var parts = path.split('.');\r\n      if (parts.length > 1 && typeof model[parts[0]] === 'object') {\r\n        return this.traverseJson(model[parts[0]], parts.splice(1).join('.'), def);\r\n      } else {\r\n        return model[parts[0]] || def;\r\n      }\r\n    }\r\n\r\n    this.updateLedData = function () {\r\n      // Reset whirl and morph params\r\n      this.opacity = 0xff;\r\n      this.morphFadeOut = true;\r\n\r\n      // Get data for selected Ufo and fill array with current colors\r\n      var selectedUfoJson = this.json.filter(val => this.traverseJson(val, this.panel.jsonFields.ufoDeviceId) === this.selectedUfo)\r\n        .sort((a, b) => new Date(this.traverseJson(b, this.panel.jsonFields.lastUpdate)[0]) - new Date(this.traverseJson(a, this.panel.jsonFields.lastUpdate)[0]))[0];\r\n      this.ufoName = this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoName);\r\n      this.ufoClientIP = this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoClientIP);\r\n      this.ufoWifiSsid = this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoSSID);\r\n      this.ufoLastUpdate = this.traverseJson(selectedUfoJson, this.panel.jsonFields.lastUpdate)[0];\r\n      if (this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds) !== '') {\r\n        this.logoColors = this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsLogo].map(val => '#' + val + this.opacity.toString(16));\r\n        this.topColors = this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsTop][this.panel.jsonFields.ufoLedsColor].map(val => '#' + val + this.opacity.toString(16));\r\n        this.bottomColors = this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsBottom][this.panel.jsonFields.ufoLedsColor].map(val => '#' + val + this.opacity.toString(16));\r\n\r\n        // Set Whirl\r\n        $interval.cancel(this.whirlIntervalTop);\r\n        if (this.traverseJson(this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsTop], this.panel.jsonFields.ufoLedsWhirlSpeed) > 0) {\r\n          this.whirlIntervalTop = $interval(() => {\r\n            if (this.traverseJson(this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsTop], this.panel.jsonFields.ufoLedsWhirlDir)) {\r\n              this.topColors.unshift(this.topColors.pop());\r\n            } else {\r\n              this.topColors.push(this.topColors.shift());\r\n            }\r\n            this.render();\r\n          }, 1000);\r\n        }\r\n\r\n        $interval.cancel(this.whirlIntervalBottom);\r\n        if (this.traverseJson(this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsBottom], this.panel.jsonFields.ufoLedsWhirlSpeed) > 0) {\r\n          this.whirlIntervalBottom = $interval(() => {\r\n            if (this.traverseJson(this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsBottom], this.panel.jsonFields.ufoLedsWhirlDir)) {\r\n              this.bottomColors.unshift(this.bottomColors.pop());\r\n            } else {\r\n              this.bottomColors.push(this.bottomColors.shift());\r\n            }\r\n            this.render();\r\n          }, 1000);\r\n        }\r\n\r\n        // Set Morph\r\n        $interval.cancel(this.morphIntervalTop);\r\n        if (this.traverseJson(this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsTop], this.panel.jsonFields.ufoLedsMorphState) !== 0) {\r\n          this.morphIntervalTop = $interval(() => {\r\n            if (this.morphFadeOut) {\r\n              this.opacity -= 0x0f;\r\n              if (this.opacity == 0x1e) {\r\n                this.morphFadeOut = !this.morphFadeOut;\r\n              }\r\n            } else {\r\n              this.opacity += 0x0f;\r\n              if (this.opacity == 0xff) {\r\n                this.morphFadeOut = !this.morphFadeOut;\r\n              }\r\n            }\r\n            this.topColors = this.topColors.map(val => val.substring(0, 7) + this.opacity.toString(16));\r\n            this.render();\r\n          }, 100);\r\n        }\r\n\r\n        $interval.cancel(this.morphIntervalBottom);\r\n        if (this.traverseJson(this.traverseJson(selectedUfoJson, this.panel.jsonFields.ufoLeds)[this.panel.jsonFields.ufoLedsBottom], this.panel.jsonFields.ufoLedsMorphState) !== 0) {\r\n          this.morphIntervalBottom = $interval(() => {\r\n            if (this.morphFadeOut) {\r\n              this.opacity -= 0x0f;\r\n              if (this.opacity == 0x1e) {\r\n                this.morphFadeOut = !this.morphFadeOut;\r\n              }\r\n            } else {\r\n              this.opacity += 0x0f;\r\n              if (this.opacity == 0xff) {\r\n                this.morphFadeOut = !this.morphFadeOut;\r\n              }\r\n            }\r\n            this.bottomColors = this.bottomColors.map(val => val.substring(0, 7) + this.opacity.toString(16));\r\n            this.render();\r\n          }, 100);\r\n        }\r\n      } else {\r\n        this.logoColors = [];\r\n        this.topColors = [];\r\n        this.bottomColors = [];\r\n      }\r\n      this.render();\r\n      console.log('Visualizing UFO on IP: ' + this.ufoClientIP + '. Connected to WiFi: ' + this.ufoWifiSsid);\r\n      console.log('UFO has ' + this.topColors.length + ' top LEDS and ' + this.bottomColors.length + ' bottom LEDS.');\r\n    }\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/plugins/djimmo-dynatrace-ufo/editor.html', 2);\r\n  }\r\n\r\n  onPanelTeardown() {\r\n  }\r\n\r\n  onDataError() {\r\n    console.log('There has been a data error!');\r\n    this.render();\r\n  }\r\n\r\n  onRender() {\r\n    this.data = {\r\n      datasets: [{\r\n        data: this.createLEDring(this.bottomColors.length),\r\n        backgroundColor: this.bottomColors,\r\n        label: 'Bottom Ring'\r\n      }, {\r\n        data: this.createLEDring(this.topColors.length),\r\n        backgroundColor: this.topColors,\r\n        label: 'Top Ring'\r\n      }],\r\n      labels: this.createLabels(this.topColors.length)\r\n    };\r\n\r\n    this.options = {\r\n      responsive: true,\r\n      aspectRatio: 1.4,\r\n      legend: false,\r\n      multiTooltipTemplate: '<%= datasetLabel %> - <%= value %>',\r\n      animation: false\r\n    };\r\n\r\n    var config = {\r\n      type: 'doughnut',\r\n      data: this.data,\r\n      options: this.options\r\n    };\r\n\r\n    if (this.ctx == null)\r\n      if (document.getElementById(this.canvasid) != null)\r\n        this.ctx = document.getElementById(this.canvasid).getContext('2d');\r\n\r\n    if (this.ctx != null) {\r\n      if (this.ufo == null) {\r\n        this.ufo = new Chart(this.ctx, config);\r\n      } else {\r\n        this.ufo.data = this.data;\r\n        this.ufo.update();\r\n      }\r\n    }\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    console.log('Data Received!');\r\n    console.log(dataList);\r\n    if (dataList.length !== 0) {\r\n      console.log(dataList[0].datapoints);\r\n      this.json = dataList[0].datapoints;\r\n\r\n      this.availUfos = [...new Set(this.json.map(val => this.traverseJson(val, this.panel.jsonFields.ufoDeviceId)))];\r\n      console.log(this.availUfos);\r\n      console.log('Selected Ufo: ' + this.selectedUfo);\r\n      if (this.selectedUfo === undefined) {\r\n        console.log('No Ufo selected so selecting first one in list: ' + this.availUfos[0]);\r\n        this.selectedUfo = this.availUfos[0];\r\n      }\r\n      this.updateLedData();\r\n    }\r\n  }\r\n\r\n  createLEDring(noOfLeds) {\r\n    var arr = new Array(noOfLeds);\r\n    for (var i = 0; i < noOfLeds; i++) {\r\n      arr[i] = 1;\r\n    }\r\n    return arr;\r\n  };\r\n\r\n  createLabels(noOfLeds) {\r\n    var arr = new Array(noOfLeds);\r\n    for (var i = 0; i < noOfLeds; i++) {\r\n      arr[i] = 'LED #' + (i + 1);\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  selectUfo() {\r\n    console.log(this.selectedUfo + ' selected.');\r\n    this.updateLedData();\r\n  }\r\n}\r\n\r\nDynatraceUfoCtrl.templateUrl = 'module.html';"]}